<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>æ‰«ç æ‰“å¼€ Â· æ¯”ä»·åŠ©æ‰‹</title>
  <link rel="stylesheet" href="styles.css?v=2" />
  <meta name="theme-color" content="#0ea5e9" />
  <style>
    .qr-container { display: flex; flex-direction: column; align-items: center; gap: 16px; padding: 24px; }
    .qr-card { background: var(--card-bg, #0b1220); border-radius: 12px; padding: 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.2); }
    .qr-canvas { width: 280px; height: 280px; }
    .url-row { display: flex; gap: 8px; width: 100%; max-width: 640px; }
    .url-row input { flex: 1; padding: 10px; border-radius: 8px; border: 1px solid #334155; background: #0f172a; color: #e2e8f0; }
    .btn-row { display: flex; gap: 8px; }
    .btn { padding: 10px 14px; border: none; border-radius: 8px; background: #0ea5e9; color: white; cursor: pointer; }
    .btn.secondary { background: #334155; }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.1/build/qrcode.min.js"></script>
</head>
<body>
  <header class="app-header"><div class="brand">ğŸ“± æ‰«ç æ‰“å¼€ Â· æ¯”ä»·åŠ©æ‰‹</div></header>
  <main class="container">
    <section class="card">
      <div class="qr-container">
        <div class="url-row">
          <input id="targetUrl" type="text" placeholder="è¾“å…¥æˆ–ç¡®è®¤è¦æ‰«ç æ‰“å¼€çš„é“¾æ¥" />
          <button id="genBtn" class="btn">ç”ŸæˆäºŒç»´ç </button>
        </div>
        <div class="qr-card">
          <canvas id="qrCanvas" class="qr-canvas"></canvas>
        </div>
        <div class="btn-row">
          <button id="copyBtn" class="btn secondary">å¤åˆ¶é“¾æ¥</button>
          <button id="downloadBtn" class="btn secondary">ä¸‹è½½äºŒç»´ç </button>
        </div>
      </div>
    </section>
  </main>
  <footer class="footer"><div>æç¤ºï¼šäºŒç»´ç é»˜è®¤æŒ‡å‘æœ¬ç«™é¦–é¡µï¼Œå¯åœ¨è¾“å…¥æ¡†æ›´æ”¹ã€‚</div></footer>

  <script>
    (function() {
      const els = {
        input: document.getElementById('targetUrl'),
        genBtn: document.getElementById('genBtn'),
        canvas: document.getElementById('qrCanvas'),
        copyBtn: document.getElementById('copyBtn'),
        downloadBtn: document.getElementById('downloadBtn'),
      };

      function defaultBaseUrl() {
        try {
          // æŒ‡å‘å½“å‰ç«™ç‚¹æ ¹è·¯å¾„ï¼Œä¾‹å¦‚ https://wd-sys.github.io/fabric-statistic/
          return new URL('.', location.href).href;
        } catch {
          return location.href;
        }
      }

      function getParam(name) {
        const u = new URL(location.href);
        return u.searchParams.get(name) || '';
      }

      async function generate(url) {
        const target = (url || '').trim() || defaultBaseUrl();
        els.input.value = target;
        await QRCode.toCanvas(els.canvas, target, { width: 280, margin: 2, color: { dark: '#000000', light: '#ffffff' } });
      }

      async function copy(text) {
        try {
          await navigator.clipboard.writeText(text);
          alert('é“¾æ¥å·²å¤åˆ¶');
        } catch {
          alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶');
        }
      }

      function downloadCanvas(filename) {
        const link = document.createElement('a');
        link.download = filename || 'qr.png';
        link.href = els.canvas.toDataURL('image/png');
        link.click();
      }

      // åˆå§‹ï¼šæ”¯æŒ ?url= å‚æ•°
      const initUrl = getParam('url') || defaultBaseUrl();
      generate(initUrl);

      els.genBtn.addEventListener('click', () => generate(els.input.value));
      els.copyBtn.addEventListener('click', () => copy(els.input.value));
      els.downloadBtn.addEventListener('click', () => downloadCanvas('qr.png'));
    })();
  </script>
</body>
</html>